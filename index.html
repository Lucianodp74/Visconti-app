<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Gestore Compiti - Gruppo Visconti</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Gestisci i compiti del team Gruppo Visconti - Join the ReEvolution">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Gruppo Visconti Tasks">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .company-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            gap: 15px;
            font-family: 'Arial', sans-serif;
        }

        .logo-text {
            font-size: 2.8rem;
            font-weight: 900;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .gruppo-text {
            background: linear-gradient(135deg, #ff8c00 0%, #ffa500 50%, #ffb347 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 4px rgba(255, 140, 0, 0.3);
        }

        .visconti-text {
            background: linear-gradient(135deg, #228b22 0%, #32cd32 50%, #90ee90 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 4px rgba(34, 139, 34, 0.3);
        }

        .tagline {
            font-size: 1rem;
            color: #ecf0f1;
            font-style: italic;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 3px;
            font-weight: 300;
            opacity: 0.9;
        }

        @supports not (-webkit-background-clip: text) {
            .gruppo-text { color: #ffa500; }
            .visconti-text { color: #32cd32; }
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .main-content {
            padding: 30px;
        }

        .alert-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: slideInRight 0.3s ease-out;
            position: relative;
            cursor: pointer;
        }

        .alert-success { background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%); color: white; border-left: 5px solid #27ae60; }
        .alert-warning { background: linear-gradient(135deg, #f39c12 0%, #f1c40f 100%); color: white; border-left: 5px solid #e67e22; }
        .alert-danger { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border-left: 5px solid #c0392b; }
        .alert-info { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; border-left: 5px solid #2980b9; }

        .alert-title { font-weight: 600; margin-bottom: 5px; font-size: 1.1rem; }
        .alert-message { opacity: 0.9; line-height: 1.4; }
        .alert-close {
            position: absolute; top: 10px; right: 15px; background: none; border: none;
            color: white; font-size: 1.2rem; cursor: pointer; opacity: 0.7; transition: opacity 0.3s;
        }
        .alert-close:hover { opacity: 1; }

        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOutRight { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }

        .due-badge {
            padding: 3px 8px; border-radius: 12px; font-size: 0.7rem;
            font-weight: 600; text-transform: uppercase; margin-left: 10px;
        }
        .due-overdue { background: #ffebee; color: #c62828; animation: pulse 2s infinite; }
        .due-today { background: #fff3e0; color: #ef6c00; }
        .due-soon { background: #f3e5f5; color: #7b1fa2; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* Form per nuovo compito */
        .task-form {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 30px; margin-bottom: 30px; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .task-form .section-title {
            color: white; border-bottom: 3px solid rgba(255, 255, 255, 0.3);
            font-size: 1.8rem; margin-bottom: 25px;
        }

        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block; margin-bottom: 8px; font-weight: 600;
            color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%; padding: 12px 15px; border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px; font-size: 16px; background: rgba(255, 255, 255, 0.1);
            color: white; transition: all 0.3s; backdrop-filter: blur(10px);
        }

        .form-group input::placeholder, .form-group textarea::placeholder { color: rgba(255, 255, 255, 0.7); }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none; border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.2); box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
        }

        .form-group select option { background: #2c3e50; color: white; }
        .form-group textarea { resize: vertical; min-height: 100px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

        /* Fix per checkbox */
        .form-group input[type="checkbox"] {
            border: none !important;
            outline: none !important;
            box-shadow: none !important;
            background: transparent !important;
        }

        .btn {
            padding: 12px 25px; border: none; border-radius: 8px; font-size: 16px;
            font-weight: 600; cursor: pointer; transition: all 0.3s; text-decoration: none;
            display: inline-block; text-align: center;
        }

        .btn-primary {
            background: rgba(255, 255, 255, 0.9); color: #667eea;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        .btn-primary:hover { background: white; transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.2); }

        .btn-success {
            background: rgba(86, 171, 47, 0.9); color: white; margin-left: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        .btn-success:hover { background: #56ab2f; transform: translateY(-2px); box-shadow: 0 10px 25px rgba(86, 171, 47, 0.3); }

        .btn-purple {
            background: rgba(155, 89, 182, 0.9); color: white; margin-left: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        .btn-purple:hover { background: #9b59b6; transform: translateY(-2px); box-shadow: 0 10px 25px rgba(155, 89, 182, 0.3); }

        .notifications-section {
            background: #f8f9fa; padding: 20px; border-radius: 10px;
            margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .notification-item {
            display: flex; align-items: center; padding: 12px 15px; background: white;
            border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #667eea; transition: transform 0.2s;
        }
        .notification-item:hover { transform: translateX(5px); }

        .notification-icon { font-size: 1.5rem; margin-right: 15px; }
        .notification-content { flex: 1; }
        .notification-title { font-weight: 600; color: #2c3e50; margin-bottom: 2px; }
        .notification-text { color: #7f8c8d; font-size: 0.9rem; }
        .notification-time { color: #bdc3c7; font-size: 0.8rem; margin-left: 15px; }

        .section-title {
            font-size: 1.5rem; color: #2c3e50; margin-bottom: 20px;
            padding-bottom: 10px; border-bottom: 3px solid #667eea;
        }

        .tasks-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }

        .task-card {
            background: white; border-radius: 10px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 5px solid #667eea; transition: transform 0.3s, box-shadow 0.3s;
        }
        .task-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.15); }

        .task-title { font-size: 1.2rem; font-weight: 600; color: #2c3e50; margin-bottom: 10px; }
        .task-description { color: #7f8c8d; margin-bottom: 15px; line-height: 1.6; }
        .task-meta {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; font-size: 0.9rem;
        }
        .task-assignee { color: #34495e; font-weight: 500; }
        .task-date { color: #7f8c8d; }

        .task-priority {
            padding: 4px 12px; border-radius: 15px; font-size: 0.8rem;
            font-weight: 600; text-transform: uppercase;
        }
        .priority-alta { background: #ffebee; color: #c62828; }
        .priority-media { background: #fff3e0; color: #ef6c00; }
        .priority-bassa { background: #e8f5e8; color: #2e7d32; }

        .task-status { display: flex; align-items: center; gap: 10px; }
        .status-select {
            padding: 8px 12px; border: 2px solid #e9ecef; border-radius: 6px;
            font-size: 14px; cursor: pointer; transition: border-color 0.3s;
        }
        .status-select:focus { outline: none; border-color: #667eea; }

        .stats-section {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 20px; border-radius: 10px; text-align: center;
        }
        .stat-number { font-size: 2.5rem; font-weight: 300; margin-bottom: 5px; }
        .stat-label { opacity: 0.9; font-size: 0.9rem; }

        .empty-state { text-align: center; padding: 60px 20px; color: #7f8c8d; }

        /* Stili per Tags */
        .tag-option {
            transition: all 0.3s;
            user-select: none;
        }
        .tag-option:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .tag-option.selected {
            box-shadow: 0 0 0 3px rgba(255,255,255,0.5);
            transform: scale(1.1);
        }

        .filter-tag {
            transition: all 0.3s;
            user-select: none;
        }
        .filter-tag:hover {
            opacity: 0.8 !important;
        }
        .filter-tag.active {
            opacity: 1 !important;
            box-shadow: 0 0 0 2px white;
        }

        /* Vista Kanban */
        .kanban-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .kanban-column {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            min-height: 400px;
        }

        .kanban-header {
            font-weight: 600;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            color: white;
        }

        .kanban-task {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: grab;
            transition: transform 0.2s;
        }

        .kanban-task:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        /* Dashboard Charts */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .chart-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        /* Team Member Cards */
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .team-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .team-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 1.5rem;
            color: white;
        }

        .btn-view {
            transition: all 0.3s;
        }

        .btn-view.active {
            background: #667eea !important;
            box-shadow: 0 2px 5px rgba(102, 126, 234, 0.3);
        }

        .task-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-edit {
            background: #3498db;
            color: white;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

        .btn-small:hover {
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; }
            .tasks-grid { grid-template-columns: 1fr; }
            .stats-section { grid-template-columns: repeat(2, 1fr); }
            .alert-container { left: 20px; right: 20px; max-width: none; }
            .company-logo { flex-direction: column; gap: 10px; }
            .logo-text { font-size: 2.2rem; }
            .task-form { padding: 20px; }
            .task-form .section-title { font-size: 1.4rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="company-logo">
                <span class="logo-text gruppo-text">GRUPPO</span>
                <span class="logo-text visconti-text">VISCONTI</span>
            </div>
            <div class="tagline">Join the ReEvolution</div>
            <h1>📋 Gestore Compiti</h1>
            <p>Organizza, monitora e traccia tutti i tuoi compiti in modo efficiente</p>
        </div>

        <div class="main-content">
            <div class="alert-container" id="alertContainer"></div>

            <!-- Form nuovo compito -->
            <div class="task-form">
                <h2 class="section-title">➕ Nuovo Compito</h2>
                <p style="margin-bottom: 20px; opacity: 0.9; font-size: 1.1rem;">
                    🚀 Crea rapidamente un nuovo compito per il team
                </p>
                <form id="taskForm">
                    <div class="form-group">
                        <label for="taskTitle">Titolo Compito *</label>
                        <input type="text" id="taskTitle" required placeholder="Es: Preparare presentazione Q4" maxlength="100">
                    </div>
                    
                    <div class="form-group">
                        <label for="taskDescription">Descrizione</label>
                        <textarea id="taskDescription" placeholder="Descrivi dettagliatamente il compito da svolgere..." maxlength="500"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskAssignee">Assegnato a *</label>
                            <select id="taskAssignee" required multiple style="height: auto; min-height: 50px;">
                                <option value="Marco Rossi">👤 Marco Rossi</option>
                                <option value="Luca Bianchi">👤 Luca Bianchi</option>
                                <option value="Sara Verde">👤 Sara Verde</option>
                                <option value="Admin" selected>👤 Admin</option>
                            </select>
                            <small style="color: rgba(255,255,255,0.8); font-size: 0.8rem;">Tieni premuto Ctrl per selezionare più persone</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="taskTags">Tags</label>
                            <div id="taskTags" style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px;">
                                <span class="tag-option" data-tag="Urgente" style="background: #e74c3c; color: white; padding: 4px 8px; border-radius: 12px; cursor: pointer; font-size: 0.8rem;">🔥 Urgente</span>
                                <span class="tag-option" data-tag="Cliente" style="background: #3498db; color: white; padding: 4px 8px; border-radius: 12px; cursor: pointer; font-size: 0.8rem;">👥 Cliente</span>
                                <span class="tag-option" data-tag="Interno" style="background: #95a5a6; color: white; padding: 4px 8px; border-radius: 12px; cursor: pointer; font-size: 0.8rem;">🏢 Interno</span>
                                <span class="tag-option" data-tag="Marketing" style="background: #e67e22; color: white; padding: 4px 8px; border-radius: 12px; cursor: pointer; font-size: 0.8rem;">📢 Marketing</span>
                                <span class="tag-option" data-tag="Sviluppo" style="background: #27ae60; color: white; padding: 4px 8px; border-radius: 12px; cursor: pointer; font-size: 0.8rem;">💻 Sviluppo</span>
                                <span class="tag-option" data-tag="Vendite" style="background: #9b59b6; color: white; padding: 4px 8px; border-radius: 12px; cursor: pointer; font-size: 0.8rem;">💰 Vendite</span>
                            </div>
                            <input type="hidden" id="selectedTags" value="">
                        </div>
                        
                        <div class="form-group">
                            <label for="taskPriority">Priorità</label>
                            <select id="taskPriority">
                                <option value="bassa">🟢 Bassa</option>
                                <option value="media" selected>🟡 Media</option>
                                <option value="alta">🔴 Alta</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskDueDate">Scadenza</label>
                            <input type="date" id="taskDueDate">
                        </div>
                        
                        <div class="form-group">
                            <label for="taskStatus">Stato Iniziale</label>
                            <select id="taskStatus">
                                <option value="da-iniziare" selected>📋 Da Iniziare</option>
                                <option value="in-corso">🚀 In Corso</option>
                                <option value="in-revisione">👁️ In Revisione</option>
                                <option value="completato">✅ Completato</option>
                                <option value="in-pausa">⏸️ In Pausa</option>
                                <option value="annullato">❌ Annullato</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="enableReminder" style="margin-right: 12px; transform: scale(1.2); accent-color: white;">
                            <span>🔔 Attiva promemoria automatico (1 giorno prima della scadenza)</span>
                        </label>
                    </div>
                    
                    <div style="margin-top: 25px; display: flex; gap: 15px; flex-wrap: wrap;">
                        <button type="submit" class="btn btn-primary" style="flex: 1; min-width: 200px;">
                            ➕ Aggiungi Compito
                        </button>
                        
                        <!-- Pulsanti Vista -->
                        <div style="display: flex; gap: 5px;">
                            <button type="button" class="btn-view active" id="viewLista" onclick="switchView('lista')" style="background: #667eea; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                📋 Lista
                            </button>
                            <button type="button" class="btn-view" id="viewDashboard" onclick="switchView('dashboard')" style="background: #95a5a6; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                📊 Dashboard
                            </button>
                            <button type="button" class="btn-view" id="viewKanban" onclick="switchView('kanban')" style="background: #95a5a6; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                📌 Kanban
                            </button>
                        </div>
                        
                        <button type="button" class="btn btn-success" onclick="exportData()" style="flex: 0 0 auto;">
                            📊 Export
                        </button>
                        <button type="button" class="btn btn-purple" onclick="checkDeadlines()" style="flex: 0 0 auto;">
                            🔔 Scadenze
                        </button>
                        <button type="button" class="btn btn-purple" onclick="clearAllData()" style="flex: 0 0 auto;">
                            🗑️ Reset
                        </button>
                    </div>
                </form>
            </div>

            <!-- Barra Filtri -->
            <div class="filters-bar" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 15px; align-items: center;">
                <div style="font-weight: 600; color: #2c3e50;">🔍 Filtri:</div>
                
                <select id="filterAssignee" onchange="applyFilters()" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="tutti">👥 Tutti gli assegnatari</option>
                    <option value="Marco Rossi">👤 Marco Rossi</option>
                    <option value="Luca Bianchi">👤 Luca Bianchi</option>
                    <option value="Sara Verde">👤 Sara Verde</option>
                    <option value="Admin">👤 Admin</option>
                </select>
                
                <select id="filterPriority" onchange="applyFilters()" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="tutte">🎯 Tutte le priorità</option>
                    <option value="alta">🔴 Alta</option>
                    <option value="media">🟡 Media</option>
                    <option value="bassa">🟢 Bassa</option>
                </select>
                
                <select id="filterStatus" onchange="applyFilters()" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="tutti">📋 Tutti gli stati</option>
                    <option value="da-iniziare">📋 Da Iniziare</option>
                    <option value="in-corso">🚀 In Corso</option>
                    <option value="completato">✅ Completato</option>
                    <option value="in-pausa">⏸️ In Pausa</option>
                </select>
                
                <div id="filterTags" style="display: flex; flex-wrap: wrap; gap: 5px;">
                    <span class="filter-tag" data-tag="Urgente" style="background: #e74c3c; color: white; padding: 4px 8px; border-radius: 12px; cursor: pointer; font-size: 0.8rem; opacity: 0.3;">🔥 Urgente</span>
                    <span class="filter-tag" data-tag="Cliente" style="background: #3498db; color: white; padding: 4px 8px; border-radius: 12px; cursor: pointer; font-size: 0.8rem; opacity: 0.3;">👥 Cliente</span>
                    <span class="filter-tag" data-tag="Interno" style="background: #95a5a6; color: white; padding: 4px 8px; border-radius: 12px; cursor: pointer; font-size: 0.8rem; opacity: 0.3;">🏢 Interno</span>
                </div>
                
                <button onclick="clearFilters()" style="background: #e74c3c; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 12px;">
                    🗑️ Reset
                </button>
            </div>

            <div class="stats-section" id="statsSection">
                <div class="stat-card">
                    <div class="stat-number" id="totalTasks">0</div>
                    <div class="stat-label">Totale Compiti</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="inProgressTasks">0</div>
                    <div class="stat-label">In Corso</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completedTasks">0</div>
                    <div class="stat-label">Completati</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="pendingTasks">0</div>
                    <div class="stat-label">Da Iniziare</div>
                </div>
            </div>

            <!-- Sezione Notifiche -->
            <div class="notifications-section" id="notificationsSection">
                <h2 class="section-title">🔔 Notifiche e Alert</h2>
                <div id="notificationsList">
                    <div class="empty-state" style="padding: 20px;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">🔔</div>
                        <p style="margin: 0;">Nessuna notifica al momento</p>
                    </div>
                </div>
            </div>

            <!-- Vista Lista -->
            <div class="tasks-section" id="listaView">
                <h2 class="section-title">📌 Compiti Attivi</h2>
                <div class="tasks-grid" id="tasksGrid">
                    <div class="empty-state">
                        <div style="font-size: 4rem; margin-bottom: 20px;">📋</div>
                        <h3>Nessun compito presente</h3>
                        <p>Aggiungi il tuo primo compito utilizzando il form sopra</p>
                    </div>
                </div>
            </div>

            <!-- Vista Dashboard -->
            <div class="tasks-section" id="dashboardView" style="display: none;">
                <h2 class="section-title">📊 Dashboard</h2>
                <div class="dashboard-grid">
                    <div class="chart-card">
                        <div class="chart-title">📈 Produttività Team</div>
                        <div id="teamProductivity"></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">📋 Tasks per Stato</div>
                        <div id="statusChart"></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">🎯 Tasks per Priorità</div>
                        <div id="priorityChart"></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">👥 Carico di Lavoro</div>
                        <div id="workloadChart"></div>
                    </div>
                </div>
                <div class="team-grid" id="teamGrid"></div>
            </div>

            <!-- Vista Kanban -->
            <div class="tasks-section" id="kanbanView" style="display: none;">
                <h2 class="section-title">📌 Kanban Board</h2>
                <div class="kanban-board" id="kanbanBoard"></div>
            </div>
        </div>
    </div>

    <script>
        // Gruppo Visconti Task Manager - Versione GitHub Pages
        
        // Variabili globali
        var taskManager = {
            tasks: [],
            notifications: [],
            alertCounter: 0,
            currentUser: 'Admin',
            teamMembers: ['Marco Rossi', 'Luca Bianchi', 'Sara Verde', 'Admin'],
            availableTags: ['Urgente', 'Cliente', 'Interno', 'Marketing', 'Sviluppo', 'Vendite'],
            currentView: 'lista',
            filters: {
                assignee: 'tutti',
                priority: 'tutte',
                status: 'tutti',
                tags: [],
                dateRange: 'tutte'
            },
            taskStates: {
                'da-iniziare': { label: '📋 Da Iniziare', class: 'status-da-iniziare' },
                'in-corso': { label: '🚀 In Corso', class: 'status-in-corso' },
                'in-revisione': { label: '👁️ In Revisione', class: 'status-in-revisione' },
                'completato': { label: '✅ Completato', class: 'status-completato' },
                'in-pausa': { label: '⏸️ In Pausa', class: 'status-in-pausa' },
                'annullato': { label: '❌ Annullato', class: 'status-annullato' }
            },
            priorities: {
                'alta': { label: '🔴 Alta', class: 'priority-alta' },
                'media': { label: '🟡 Media', class: 'priority-media' },
                'bassa': { label: '🟢 Bassa', class: 'priority-bassa' }
            }
        };

        // Funzioni di utilità
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            var date = new Date(dateString);
            return date.toLocaleDateString('it-IT');
        }

        // Sistema di storage sicuro per GitHub Pages
        function saveData() {
            try {
                var data = {
                    tasks: taskManager.tasks,
                    notifications: taskManager.notifications,
                    lastSaved: new Date().toISOString()
                };
                
                // Usa sessionStorage come fallback se localStorage non è disponibile
                var storage = window.localStorage || window.sessionStorage;
                if (storage) {
                    storage.setItem('gruppoViscontiTasks', JSON.stringify(data));
                    console.log('✅ Dati salvati con successo');
                } else {
                    console.warn('⚠️ Storage non disponibile, dati solo in memoria');
                }
            } catch (error) {
                console.error('❌ Errore salvataggio:', error);
                showAlert('warning', 'Avviso', 'I dati saranno persi al refresh della pagina');
            }
        }

        function loadData() {
            try {
                var storage = window.localStorage || window.sessionStorage;
                if (storage) {
                    var savedData = storage.getItem('gruppoViscontiTasks');
                    if (savedData) {
                        var data = JSON.parse(savedData);
                        taskManager.tasks = data.tasks || [];
                        taskManager.notifications = data.notifications || [];
                        console.log('✅ Dati caricati: ' + taskManager.tasks.length + ' tasks');
                        return true;
                    }
                }
                return false;
            } catch (error) {
                console.error('❌ Errore caricamento:', error);
                taskManager.tasks = [];
                taskManager.notifications = [];
                return false;
            }
        }

        // Sistema di Alert
        function showAlert(type, title, message, duration) {
            duration = duration || 5000;
            taskManager.alertCounter++;
            var alertId = 'alert-' + taskManager.alertCounter;
            
            var alertElement = document.createElement('div');
            alertElement.id = alertId;
            alertElement.className = 'alert alert-' + type;
            alertElement.innerHTML = 
                '<button class="alert-close" onclick="closeAlert(\'' + alertId + '\')">&times;</button>' +
                '<div class="alert-title">' + title + '</div>' +
                '<div class="alert-message">' + message + '</div>';
            
            document.getElementById('alertContainer').appendChild(alertElement);
            setTimeout(function() {
                closeAlert(alertId);
            }, duration);
        }

        function closeAlert(alertId) {
            var alert = document.getElementById(alertId);
            if (alert) {
                alert.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(function() {
                    if (alert.parentNode) {
                        alert.parentNode.removeChild(alert);
                    }
                }, 300);
            }
        }

        function getTimeAgo(timestamp) {
            var now = new Date();
            var time = new Date(timestamp);
            var diffMs = now - time;
            var diffMins = Math.floor(diffMs / 60000);
            var diffHours = Math.floor(diffMs / 3600000);
            var diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Ora';
            if (diffMins < 60) return diffMins + 'm fa';
            if (diffHours < 24) return diffHours + 'h fa';
            return diffDays + 'g fa';
        }

        function getDueBadge(dueDate) {
            if (!dueDate) return '';
            
            var today = new Date();
            today.setHours(0, 0, 0, 0);
            var due = new Date(dueDate);
            due.setHours(0, 0, 0, 0);
            var diffTime = due - today;
            var diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays < 0) {
                return '<span class="due-badge due-overdue">Scaduto</span>';
            } else if (diffDays === 0) {
                return '<span class="due-badge due-today">Oggi</span>';
            } else if (diffDays <= 3) {
                return '<span class="due-badge due-soon">' + diffDays + 'g</span>';
            }
            return '';
        }

        // Sistema Notifiche
        function addNotification(type, title, message, taskId) {
            var notification = {
                id: generateId(),
                type: type,
                title: title,
                message: message,
                taskId: taskId || null,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            taskManager.notifications.unshift(notification);
            
            if (taskManager.notifications.length > 50) {
                taskManager.notifications = taskManager.notifications.slice(0, 50);
            }
            
            saveData();
            renderNotifications();
            
            var icons = {
                'deadline': '⏰',
                'overdue': '🚨',
                'completed': '✅',
                'assigned': '📋',
                'reminder': '🔔',
                'info': 'ℹ️'
            };
            
            var alertType = type === 'overdue' ? 'danger' : 
                             type === 'deadline' ? 'warning' : 
                             type === 'completed' ? 'success' : 'info';
            
            showAlert(alertType, (icons[type] || '🔔') + ' ' + title, message);
        }

        function renderNotifications() {
            var notificationsList = document.getElementById('notificationsList');
            if (!notificationsList) return;
            
            if (taskManager.notifications.length === 0) {
                notificationsList.innerHTML = 
                    '<div class="empty-state" style="padding: 20px;">' +
                    '<div style="font-size: 2rem; margin-bottom: 10px;">🔔</div>' +
                    '<p style="margin: 0;">Nessuna notifica al momento</p>' +
                    '</div>';
                return;
            }

            var icons = {
                'deadline': '⏰', 'overdue': '🚨', 'completed': '✅',
                'assigned': '📋', 'reminder': '🔔', 'info': 'ℹ️'
            };

            var html = '';
            var displayNotifications = taskManager.notifications.slice(0, 10);
            for (var i = 0; i < displayNotifications.length; i++) {
                var notif = displayNotifications[i];
                html += '<div class="notification-item">' +
                    '<div class="notification-icon">' + (icons[notif.type] || '🔔') + '</div>' +
                    '<div class="notification-content">' +
                    '<div class="notification-title">' + notif.title + '</div>' +
                    '<div class="notification-text">' + notif.message + '</div>' +
                    '</div>' +
                    '<div class="notification-time">' + getTimeAgo(notif.timestamp) + '</div>' +
                    '</div>';
            }
            
            notificationsList.innerHTML = html;
        }

        // Gestione Form e Tasks
        function addTask(event) {
            event.preventDefault();
            
            var title = document.getElementById('taskTitle').value.trim();
            var description = document.getElementById('taskDescription').value.trim();
            var assigneeSelect = document.getElementById('taskAssignee');
            var selectedAssignees = [];
            for (var i = 0; i < assigneeSelect.options.length; i++) {
                if (assigneeSelect.options[i].selected) {
                    selectedAssignees.push(assigneeSelect.options[i].value);
                }
            }
            var priority = document.getElementById('taskPriority').value;
            var dueDate = document.getElementById('taskDueDate').value;
            var status = document.getElementById('taskStatus').value;
            var selectedTags = document.getElementById('selectedTags').value;
            var enableReminder = document.getElementById('enableReminder').checked;
            
            if (!title || selectedAssignees.length === 0) {
                showAlert('danger', 'Errore', 'Inserisci almeno il titolo e seleziona un assegnatario');
                return;
            }
            
            var task = {
                id: generateId(),
                title: title,
                description: description,
                assignee: selectedAssignees,
                priority: priority,
                dueDate: dueDate,
                status: status,
                tags: selectedTags ? selectedTags.split(',') : [],
                enableReminder: enableReminder,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                createdBy: taskManager.currentUser
            };
            
            taskManager.tasks.push(task);
            saveData();
            
            // Reset form
            document.getElementById('taskForm').reset();
            document.getElementById('selectedTags').value = '';
            var tagOptions = document.querySelectorAll('.tag-option');
            for (var i = 0; i < tagOptions.length; i++) {
                tagOptions[i].classList.remove('selected');
            }
            
            renderCurrentView();
            updateStats();
            
            addNotification('assigned', 'Nuovo Compito Creato', 
                'Il compito "' + task.title + '" è stato assegnato a ' + selectedAssignees.join(', '), task.id);
            
            showAlert('success', 'Compito Aggiunto', 'Il compito "' + title + '" è stato creato con successo');
        }

        // Variabile per gestire la modalità di modifica
        var editingTaskId = null;

        function editTask(taskId) {
            var task = taskManager.tasks.find(function(t) { return t.id === taskId; });
            if (!task) return;
            
            // Imposta la modalità di modifica
            editingTaskId = taskId;
            
            // Popola il form con i dati del task
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskDescription').value = task.description || '';
            document.getElementById('taskPriority').value = task.priority;
            document.getElementById('taskDueDate').value = task.dueDate || '';
            document.getElementById('taskStatus').value = task.status;
            document.getElementById('enableReminder').checked = task.enableReminder || false;
            
            // Seleziona assegnatari
            var assigneeSelect = document.getElementById('taskAssignee');
            for (var i = 0; i < assigneeSelect.options.length; i++) {
                var assignees = Array.isArray(task.assignee) ? task.assignee : [task.assignee];
                assigneeSelect.options[i].selected = assignees.indexOf(assigneeSelect.options[i].value) !== -1;
            }
            
            // Seleziona tags
            var tagOptions = document.querySelectorAll('.tag-option');
            for (var i = 0; i < tagOptions.length; i++) {
                var isSelected = task.tags && task.tags.indexOf(tagOptions[i].getAttribute('data-tag')) !== -1;
                if (isSelected) {
                    tagOptions[i].classList.add('selected');
                } else {
                    tagOptions[i].classList.remove('selected');
                }
            }
            updateSelectedTags();
            
            // Cambia il testo del pulsante e mostra un indicatore
            var submitButton = document.querySelector('.btn-primary');
            if (submitButton) {
                submitButton.innerHTML = '✏️ Aggiorna Compito';
                submitButton.style.background = 'rgba(52, 152, 219, 0.9)';
            }
            
            // Aggiungi un indicatore visivo
            var taskForm = document.querySelector('.task-form');
            if (taskForm) {
                taskForm.style.borderLeft = '5px solid #3498db';
            }
            
            // Scroll al form
            taskForm.scrollIntoView({ behavior: 'smooth' });
            
            showAlert('info', 'Modalità Modifica', 'Modifica i dati e clicca "Aggiorna Compito" per salvare le modifiche');
        }

        function deleteTask(taskId) {
            if (!confirm('Sei sicuro di voler eliminare questo compito?')) return;
            
            var task = taskManager.tasks.find(function(t) { return t.id === taskId; });
            if (task) {
                taskManager.tasks = taskManager.tasks.filter(function(t) { return t.id !== taskId; });
                saveData();
                renderCurrentView();
                updateStats();
                
                addNotification('info', 'Compito Eliminato', 
                    'Il compito "' + task.title + '" è stato eliminato', taskId);
                
                showAlert('info', 'Compito Eliminato', 'Il compito è stato rimosso con successo');
            }
        }

        function updateTaskStatus(taskId, newStatus) {
            for (var i = 0; i < taskManager.tasks.length; i++) {
                if (taskManager.tasks[i].id === taskId) {
                    var task = taskManager.tasks[i];
                    var oldStatus = task.status;
                    task.status = newStatus;
                    task.updatedAt = new Date().toISOString();
                    saveData();
                    renderCurrentView();
                    updateStats();
                    
                    if (newStatus === 'completato' && oldStatus !== 'completato') {
                        addNotification('completed', 'Compito Completato!', 
                            'Il compito "' + task.title + '" è stato completato', task.id);
                    } else if (newStatus === 'in-corso' && oldStatus === 'da-iniziare') {
                        addNotification('reminder', 'Compito Iniziato', 
                            'Il lavoro su "' + task.title + '" è iniziato', task.id);
                    }
                    break;
                }
            }
        }

        // Gestione Tags
        function initializeTags() {
            var tagOptions = document.querySelectorAll('.tag-option');
            for (var i = 0; i < tagOptions.length; i++) {
                tagOptions[i].addEventListener('click', function() {
                    this.classList.toggle('selected');
                    updateSelectedTags();
                });
            }
        }

        function updateSelectedTags() {
            var selectedTags = [];
            var tagOptions = document.querySelectorAll('.tag-option.selected');
            for (var i = 0; i < tagOptions.length; i++) {
                selectedTags.push(tagOptions[i].getAttribute('data-tag'));
            }
            document.getElementById('selectedTags').value = selectedTags.join(',');
        }

        // Sistema Filtri
        function applyFilters() {
            taskManager.filters.assignee = document.getElementById('filterAssignee').value;
            taskManager.filters.priority = document.getElementById('filterPriority').value;
            taskManager.filters.status = document.getElementById('filterStatus').value;
            
            renderCurrentView();
        }

        function clearFilters() {
            taskManager.filters = {
                assignee: 'tutti',
                priority: 'tutte',
                status: 'tutti',
                tags: []
            };
            
            document.getElementById('filterAssignee').value = 'tutti';
            document.getElementById('filterPriority').value = 'tutte';
            document.getElementById('filterStatus').value = 'tutti';
            
            var filterTags = document.querySelectorAll('.filter-tag');
            for (var i = 0; i < filterTags.length; i++) {
                filterTags[i].classList.remove('active');
            }
            
            renderCurrentView();
        }

        function initializeFilterTags() {
            var filterTags = document.querySelectorAll('.filter-tag');
            for (var i = 0; i < filterTags.length; i++) {
                filterTags[i].addEventListener('click', function() {
                    this.classList.toggle('active');
                    updateTagFilters();
                });
            }
        }

        function updateTagFilters() {
            taskManager.filters.tags = [];
            var activeTags = document.querySelectorAll('.filter-tag.active');
            for (var i = 0; i < activeTags.length; i++) {
                taskManager.filters.tags.push(activeTags[i].getAttribute('data-tag'));
            }
            renderCurrentView();
        }

        function getFilteredTasks() {
            return taskManager.tasks.filter(function(task) {
                // Filtro Assegnato
                if (taskManager.filters.assignee !== 'tutti') {
                    var assignees = Array.isArray(task.assignee) ? task.assignee : [task.assignee];
                    if (assignees.indexOf(taskManager.filters.assignee) === -1) {
                        return false;
                    }
                }
                
                // Filtro Priorità
                if (taskManager.filters.priority !== 'tutte' && task.priority !== taskManager.filters.priority) {
                    return false;
                }
                
                // Filtro Stato
                if (taskManager.filters.status !== 'tutti' && task.status !== taskManager.filters.status) {
                    return false;
                }
                
                // Filtro Tags
                if (taskManager.filters.tags.length > 0) {
                    var taskTags = task.tags || [];
                    var hasMatchingTag = false;
                    for (var i = 0; i < taskManager.filters.tags.length; i++) {
                        if (taskTags.indexOf(taskManager.filters.tags[i]) !== -1) {
                            hasMatchingTag = true;
                            break;
                        }
                    }
                    if (!hasMatchingTag) {
                        return false;
                    }
                }
                
                return true;
            });
        }

        // Gestione Views
        function switchView(viewType) {
            taskManager.currentView = viewType;
            
            // Reset pulsanti
            var viewButtons = document.querySelectorAll('.btn-view');
            for (var i = 0; i < viewButtons.length; i++) {
                viewButtons[i].classList.remove('active');
                viewButtons[i].style.background = '#95a5a6';
            }
            
            // Attiva pulsante corrente
            var activeButton = document.getElementById('view' + viewType.charAt(0).toUpperCase() + viewType.slice(1));
            if (activeButton) {
                activeButton.classList.add('active');
                activeButton.style.background = '#667eea';
            }
            
            // Nasconde tutte le view
            document.getElementById('listaView').style.display = 'none';
            document.getElementById('dashboardView').style.display = 'none';
            document.getElementById('kanbanView').style.display = 'none';
            
            // Mostra view corrente
            if (viewType === 'lista') {
                document.getElementById('listaView').style.display = 'block';
                renderTasks();
            } else if (viewType === 'dashboard') {
                document.getElementById('dashboardView').style.display = 'block';
                renderDashboard();
            } else if (viewType === 'kanban') {
                document.getElementById('kanbanView').style.display = 'block';
                renderKanban();
            }
        }

        function renderCurrentView() {
            if (taskManager.currentView === 'lista') {
                renderTasks();
            } else if (taskManager.currentView === 'dashboard') {
                renderDashboard();
            } else if (taskManager.currentView === 'kanban') {
                renderKanban();
            }
        }

        // Rendering Tasks
        function renderTasks() {
            var tasksGrid = document.getElementById('tasksGrid');
            var filteredTasks = getFilteredTasks();
            
            if (filteredTasks.length === 0) {
                tasksGrid.innerHTML = 
                    '<div class="empty-state">' +
                    '<div style="font-size: 4rem; margin-bottom: 20px;">📋</div>' +
                    '<h3>Nessun compito presente</h3>' +
                    '<p>Aggiungi il tuo primo compito utilizzando il form sopra</p>' +
                    '</div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < filteredTasks.length; i++) {
                var task = filteredTasks[i];
                var assignees = Array.isArray(task.assignee) ? task.assignee : [task.assignee];
                var tags = task.tags || [];
                
                html += 
                    '<div class="task-card">' +
                    '<div class="task-title">' + task.title + getDueBadge(task.dueDate) + '</div>' +
                    '<div class="task-description">' + (task.description || 'Nessuna descrizione') + '</div>' +
                    '<div class="task-meta">' +
                    '<span class="task-assignee">👤 ' + assignees.join(', ') + '</span>' +
                    '<span class="task-date">📅 ' + (task.dueDate ? formatDate(task.dueDate) : 'Nessuna scadenza') + '</span>' +
                    '</div>';
                
                // Tags
                if (tags.length > 0) {
                    html += '<div style="margin-bottom: 15px;">';
                    for (var j = 0; j < tags.length; j++) {
                        var tagColors = {
                            'Urgente': '#e74c3c', 'Cliente': '#3498db', 'Interno': '#95a5a6',
                            'Marketing': '#e67e22', 'Sviluppo': '#27ae60', 'Vendite': '#9b59b6'
                        };
                        html += '<span style="background: ' + (tagColors[tags[j]] || '#95a5a6') + '; color: white; padding: 2px 6px; border-radius: 8px; font-size: 0.7rem; margin-right: 4px;">' + tags[j] + '</span>';
                    }
                    html += '</div>';
                }
                
                html += 
                    '<div class="task-status">' +
                    '<span class="task-priority ' + taskManager.priorities[task.priority].class + '">' + taskManager.priorities[task.priority].label + '</span>' +
                    '<select class="status-select" onchange="updateTaskStatus(\'' + task.id + '\', this.value)">';
                
                for (var status in taskManager.taskStates) {
                    var selected = task.status === status ? ' selected' : '';
                    html += '<option value="' + status + '"' + selected + '>' + taskManager.taskStates[status].label + '</option>';
                }
                
                html += '</select></div>' +
                    '<div class="task-actions">' +
                    '<button class="btn-small btn-edit" onclick="editTask(\'' + task.id + '\')">✏️ Modifica</button>' +
                    '<button class="btn-small btn-delete" onclick="deleteTask(\'' + task.id + '\')">🗑️ Elimina</button>' +
                    '</div>' +
                    '</div>';
            }
            
            tasksGrid.innerHTML = html;
        }

        // Vista Dashboard
        function renderDashboard() {
            renderTeamProductivity();
            renderStatusChart();
            renderPriorityChart();
            renderWorkloadChart();
            renderTeamGrid();
        }

        function renderTeamProductivity() {
            var container = document.getElementById('teamProductivity');
            if (!container) return;
            
            var filteredTasks = getFilteredTasks();
            var completedTasks = filteredTasks.filter(function(t) { return t.status === 'completato'; }).length;
            var totalTasks = filteredTasks.length;
            var percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            container.innerHTML = 
                '<div class="progress-bar">' +
                '<div class="progress-fill" style="width: ' + percentage + '%;"></div>' +
                '</div>' +
                '<div style="display: flex; justify-content: space-between; margin-top: 10px;">' +
                '<span>Completati: ' + completedTasks + '</span>' +
                '<span>Totali: ' + totalTasks + '</span>' +
                '<span>' + percentage + '%</span>' +
                '</div>';
        }

        function renderStatusChart() {
            var container = document.getElementById('statusChart');
            if (!container) return;
            
            var filteredTasks = getFilteredTasks();
            var statusCounts = {};
            
            // Conta tasks per stato
            var statusKeys = Object.keys(taskManager.taskStates);
            for (var i = 0; i < statusKeys.length; i++) {
                statusCounts[statusKeys[i]] = 0;
            }
            
            for (var i = 0; i < filteredTasks.length; i++) {
                statusCounts[filteredTasks[i].status]++;
            }
            
            var html = '';
            for (var status in statusCounts) {
                var count = statusCounts[status];
                var percentage = filteredTasks.length > 0 ? (count / filteredTasks.length) * 100 : 0;
                html += 
                    '<div style="margin-bottom: 10px;">' +
                    '<div style="display: flex; justify-content: space-between; margin-bottom: 5px;">' +
                    '<span>' + taskManager.taskStates[status].label + '</span>' +
                    '<span>' + count + '</span>' +
                    '</div>' +
                    '<div class="progress-bar">' +
                    '<div class="progress-fill" style="width: ' + percentage + '%;"></div>' +
                    '</div>' +
                    '</div>';
            }
            
            container.innerHTML = html;
        }

        function renderPriorityChart() {
            var container = document.getElementById('priorityChart');
            if (!container) return;
            
            var filteredTasks = getFilteredTasks();
            var priorityCounts = { alta: 0, media: 0, bassa: 0 };
            
            for (var i = 0; i < filteredTasks.length; i++) {
                priorityCounts[filteredTasks[i].priority]++;
            }
            
            var html = '';
            var colors = { alta: '#e74c3c', media: '#f39c12', bassa: '#27ae60' };
            
            for (var priority in priorityCounts) {
                var count = priorityCounts[priority];
                var percentage = filteredTasks.length > 0 ? (count / filteredTasks.length) * 100 : 0;
                html += 
                    '<div style="margin-bottom: 10px;">' +
                    '<div style="display: flex; justify-content: space-between; margin-bottom: 5px;">' +
                    '<span>' + taskManager.priorities[priority].label + '</span>' +
                    '<span>' + count + '</span>' +
                    '</div>' +
                    '<div class="progress-bar">' +
                    '<div style="height: 100%; background: ' + colors[priority] + '; width: ' + percentage + '%; transition: width 0.3s ease;"></div>' +
                    '</div>' +
                    '</div>';
            }
            
            container.innerHTML = html;
        }

        function renderWorkloadChart() {
            var container = document.getElementById('workloadChart');
            if (!container) return;
            
            var filteredTasks = getFilteredTasks();
            var workload = {};
            
            // Inizializza contatori
            for (var i = 0; i < taskManager.teamMembers.length; i++) {
                workload[taskManager.teamMembers[i]] = 0;
            }
            
            // Conta tasks per membro
            for (var i = 0; i < filteredTasks.length; i++) {
                var assignees = Array.isArray(filteredTasks[i].assignee) ? filteredTasks[i].assignee : [filteredTasks[i].assignee];
                for (var j = 0; j < assignees.length; j++) {
                    if (workload[assignees[j]] !== undefined) {
                        workload[assignees[j]]++;
                    }
                }
            }
            
            var workloadValues = [];
            for (var member in workload) {
                workloadValues.push(workload[member]);
            }
            var maxTasks = Math.max.apply(Math, workloadValues);
            var html = '';
            
            for (var member in workload) {
                var count = workload[member];
                var percentage = maxTasks > 0 ? (count / maxTasks) * 100 : 0;
                html += 
                    '<div style="margin-bottom: 10px;">' +
                    '<div style="display: flex; justify-content: space-between; margin-bottom: 5px;">' +
                    '<span>👤 ' + member + '</span>' +
                    '<span>' + count + ' tasks</span>' +
                    '</div>' +
                    '<div class="progress-bar">' +
                    '<div class="progress-fill" style="width: ' + percentage + '%;"></div>' +
                    '</div>' +
                    '</div>';
            }
            
            container.innerHTML = html;
        }

        function renderTeamGrid() {
            var container = document.getElementById('teamGrid');
            if (!container) return;
            
            var filteredTasks = getFilteredTasks();
            var html = '';
            
            for (var i = 0; i < taskManager.teamMembers.length; i++) {
                var member = taskManager.teamMembers[i];
                var memberTasks = filteredTasks.filter(function(task) {
                    var assignees = Array.isArray(task.assignee) ? task.assignee : [task.assignee];
                    return assignees.indexOf(member) !== -1;
                });
                
                var completedTasks = memberTasks.filter(function(t) { return t.status === 'completato'; }).length;
                var percentage = memberTasks.length > 0 ? Math.round((completedTasks / memberTasks.length) * 100) : 0;
                
                html += 
                    '<div class="team-card">' +
                    '<div class="team-avatar">' + member.charAt(0) + '</div>' +
                    '<div style="font-weight: 600; margin-bottom: 5px;">' + member + '</div>' +
                    '<div style="font-size: 0.9rem; color: #7f8c8d; margin-bottom: 10px;">' + memberTasks.length + ' tasks attivi</div>' +
                    '<div class="progress-bar">' +
                    '<div class="progress-fill" style="width: ' + percentage + '%;"></div>' +
                    '</div>' +
                    '<div style="font-size: 0.8rem; margin-top: 5px;">' + percentage + '% completato</div>' +
                    '</div>';
            }
            
            container.innerHTML = html;
        }

        // Vista Kanban
        function renderKanban() {
            var container = document.getElementById('kanbanBoard');
            if (!container) return;
            
            var filteredTasks = getFilteredTasks();
            
            var columns = [
                { id: 'da-iniziare', title: '📋 Da Iniziare', color: '#95a5a6' },
                { id: 'in-corso', title: '🚀 In Corso', color: '#3498db' },
                { id: 'in-revisione', title: '👁️ In Revisione', color: '#f39c12' },
                { id: 'completato', title: '✅ Completato', color: '#27ae60' }
            ];
            
            var html = '';
            
            for (var i = 0; i < columns.length; i++) {
                var column = columns[i];
                var columnTasks = filteredTasks.filter(function(task) {
                    return task.status === column.id;
                });
                
                html += 
                    '<div class="kanban-column">' +
                    '<div class="kanban-header" style="background: ' + column.color + ';">' +
                    column.title + ' (' + columnTasks.length + ')' +
                    '</div>';
                
                for (var j = 0; j < columnTasks.length; j++) {
                    var task = columnTasks[j];
                    var assignees = Array.isArray(task.assignee) ? task.assignee : [task.assignee];
                    var tags = task.tags || [];
                    
                    html += 
                        '<div class="kanban-task" data-task-id="' + task.id + '">' +
                        '<div style="font-weight: 600; margin-bottom: 8px;">' + task.title + '</div>' +
                        '<div style="font-size: 0.9rem; color: #7f8c8d; margin-bottom: 8px;">' + (task.description || '') + '</div>' +
                        '<div style="margin-bottom: 8px;">';
                    
                    // Tags
                    for (var k = 0; k < tags.length; k++) {
                        var tagColors = {
                            'Urgente': '#e74c3c', 'Cliente': '#3498db', 'Interno': '#95a5a6',
                            'Marketing': '#e67e22', 'Sviluppo': '#27ae60', 'Vendite': '#9b59b6'
                        };
                        html += '<span style="background: ' + (tagColors[tags[k]] || '#95a5a6') + '; color: white; padding: 2px 6px; border-radius: 8px; font-size: 0.7rem; margin-right: 4px;">' + tags[k] + '</span>';
                    }
                    
                    html += '</div>' +
                        '<div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem;">' +
                        '<span>👤 ' + assignees.join(', ') + '</span>' +
                        '<span class="task-priority ' + taskManager.priorities[task.priority].class + '" style="padding: 2px 6px; border-radius: 8px;">' + taskManager.priorities[task.priority].label + '</span>' +
                        '</div>' +
                        '</div>';
                }
                
                html += '</div>';
            }
            
            container.innerHTML = html;
        }

        // Statistiche
        function updateStats() {
            var filteredTasks = getFilteredTasks();
            
            var totalEl = document.getElementById('totalTasks');
            var inProgressEl = document.getElementById('inProgressTasks');
            var completedEl = document.getElementById('completedTasks');
            var pendingEl = document.getElementById('pendingTasks');
            
            if (totalEl) totalEl.textContent = filteredTasks.length;
            if (inProgressEl) inProgressEl.textContent = filteredTasks.filter(function(t) { return t.status === 'in-corso'; }).length;
            if (completedEl) completedEl.textContent = filteredTasks.filter(function(t) { return t.status === 'completato'; }).length;
            if (pendingEl) pendingEl.textContent = filteredTasks.filter(function(t) { return t.status === 'da-iniziare'; }).length;
        }

        // Controllo Scadenze
        function checkDeadlines() {
            var today = new Date();
            today.setHours(0, 0, 0, 0);
            
            var overdueTasks = [];
            var dueTodayTasks = [];
            var dueSoonTasks = [];
            
            for (var i = 0; i < taskManager.tasks.length; i++) {
                var task = taskManager.tasks[i];
                if (!task.dueDate || task.status === 'completato') continue;
                
                var dueDate = new Date(task.dueDate);
                dueDate.setHours(0, 0, 0, 0);
                
                if (dueDate < today) {
                    overdueTasks.push(task);
                } else if (dueDate.getTime() === today.getTime()) {
                    dueTodayTasks.push(task);
                } else if (dueDate <= new Date(today.getTime() + 3 * 24 * 60 * 60 * 1000)) {
                    dueSoonTasks.push(task);
                }
            }
            
            // Notifiche per scadenze
            for (var i = 0; i < overdueTasks.length; i++) {
                addNotification('overdue', 'Compito Scaduto!', 
                    'Il compito "' + overdueTasks[i].title + '" è scaduto', overdueTasks[i].id);
            }
            
            for (var i = 0; i < dueTodayTasks.length; i++) {
                addNotification('deadline', 'Scadenza Oggi!', 
                    'Il compito "' + dueTodayTasks[i].title + '" scade oggi', dueTodayTasks[i].id);
            }
            
            var totalAlerts = overdueTasks.length + dueTodayTasks.length + dueSoonTasks.length;
            if (totalAlerts === 0) {
                showAlert('success', 'Nessuna Scadenza Urgente', 'Tutti i compiti sono in regola con le scadenze');
            } else {
                showAlert('warning', 'Scadenze Rilevate', 
                    totalAlerts + ' compiti richiedono attenzione per le scadenze');
            }
        }

        // Export dati semplificato
        function exportData() {
            var filteredTasks = getFilteredTasks();
            if (filteredTasks.length === 0) {
                showAlert('warning', 'Nessun Dato', 'Non ci sono compiti da esportare');
                return;
            }
            
            var csvContent = 'Titolo,Descrizione,Assegnato a,Priorità,Stato,Scadenza,Tags,Creato il\n';
            
            for (var i = 0; i < filteredTasks.length; i++) {
                var task = filteredTasks[i];
                var assignees = Array.isArray(task.assignee) ? task.assignee.join('; ') : task.assignee;
                var tags = task.tags ? task.tags.join('; ') : '';
                
                var row = [
                    '"' + (task.title || '').replace(/"/g, '""') + '"',
                    '"' + (task.description || '').replace(/"/g, '""') + '"',
                    '"' + assignees + '"',
                    '"' + taskManager.priorities[task.priority].label + '"',
                    '"' + taskManager.taskStates[task.status].label + '"',
                    '"' + (task.dueDate ? formatDate(task.dueDate) : '') + '"',
                    '"' + tags + '"',
                    '"' + formatDate(task.createdAt) + '"'
                ].join(',');
                
                csvContent += row + '\n';
            }
            
            var blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement('a');
            
            if (link.download !== undefined) {
                var fileName = 'Compiti_GruppoVisconti_' + new Date().toISOString().split('T')[0] + '.csv';
                var url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', fileName);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showAlert('success', 'Export Completato', 'File CSV scaricato con successo');
            } else {
                showAlert('danger', 'Errore Export', 'Download non supportato su questo browser');
            }
        }

        // Reset completo dei dati
        function clearAllData() {
            if (!confirm('Sei sicuro di voler eliminare TUTTI i compiti e le notifiche? Questa azione non può essere annullata.')) {
                return;
            }
            
            taskManager.tasks = [];
            taskManager.notifications = [];
            
            try {
                var storage = window.localStorage || window.sessionStorage;
                if (storage) {
                    storage.removeItem('gruppoViscontiTasks');
                }
            } catch (error) {
                console.error('Errore durante la cancellazione:', error);
            }
            
            renderCurrentView();
            renderNotifications();
            updateStats();
            
            showAlert('info', 'Dati Cancellati', 'Tutti i compiti e le notifiche sono stati eliminati');
        }

        // Funzioni di demo per popolare con dati di esempio
        function addSampleTasks() {
            var sampleTasks = [
                {
                    id: generateId(),
                    title: 'Preparare presentazione Q4',
                    description: 'Creare slides per la presentazione dei risultati del quarto trimestre',
                    assignee: ['Marco Rossi'],
                    priority: 'alta',
                    dueDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    status: 'in-corso',
                    tags: ['Urgente', 'Cliente'],
                    enableReminder: true,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    createdBy: 'Admin'
                },
                {
                    id: generateId(),
                    title: 'Aggiornare il sito web',
                    description: 'Implementare le nuove funzionalità richieste dal cliente',
                    assignee: ['Luca Bianchi', 'Sara Verde'],
                    priority: 'media',
                    dueDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    status: 'da-iniziare',
                    tags: ['Sviluppo', 'Cliente'],
                    enableReminder: false,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    createdBy: 'Admin'
                },
                {
                    id: generateId(),
                    title: 'Campagna marketing sui social',
                    description: 'Pianificare e lanciare la nuova campagna promozionale',
                    assignee: ['Sara Verde'],
                    priority: 'bassa',
                    dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    status: 'completato',
                    tags: ['Marketing', 'Interno'],
                    enableReminder: false,
                    createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                    updatedAt: new Date().toISOString(),
                    createdBy: 'Admin'
                }
            ];
            
            taskManager.tasks = taskManager.tasks.concat(sampleTasks);
            saveData();
            renderCurrentView();
            updateStats();
            
            showAlert('success', 'Dati Demo Aggiunti', 'Sono stati aggiunti alcuni compiti di esempio');
        }

        // Inizializzazione
        function init() {
            console.log('🚀 Inizializzazione Task Manager Gruppo Visconti');
            
            // Carica dati
            var dataLoaded = loadData();
            
            // Setup eventi
            var taskForm = document.getElementById('taskForm');
            if (taskForm) {
                taskForm.addEventListener('submit', addTask);
            }
            
            // Inizializza componenti
            initializeTags();
            initializeFilterTags();
            
            // Render iniziale
            renderCurrentView();
            renderNotifications();
            updateStats();
            
            // Se non ci sono dati, mostra un alert informativo
            if (!dataLoaded || taskManager.tasks.length === 0) {
                setTimeout(function() {
                    showAlert('info', 'Benvenuto!', 
                        'Questa è la prima volta che usi l\'app. Aggiungi il tuo primo compito!', 8000);
                }, 1000);
            } else {
                // Controllo automatico scadenze se ci sono tasks
                setTimeout(checkDeadlines, 2000);
            }
            
            console.log('✅ Task Manager inizializzato con successo');
        }

        // Auto-save ogni 30 secondi
        function startAutoSave() {
            setInterval(function() {
                if (taskManager.tasks.length > 0 || taskManager.notifications.length > 0) {
                    saveData();
                }
            }, 30000);
        }

        // Avvia l'applicazione quando la pagina è carica
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                init();
                startAutoSave();
            });
        } else {
            init();
            startAutoSave();
        }

        // Funzione per aggiungere dati demo (richiamabile dalla console)
        window.addDemoData = addSampleTasks;
        
        // Gestione visibilità pagina per il salvataggio
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden') {
                saveData();
            }
        });

        // Salvataggio prima della chiusura della pagina
        window.addEventListener('beforeunload', function() {
            saveData();
        });
    </script>
</body>
</html>
